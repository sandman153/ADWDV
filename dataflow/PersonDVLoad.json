{
	"name": "PersonDVLoad",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "PersonStage",
						"type": "DatasetReference"
					},
					"name": "PersonSource"
				},
				{
					"dataset": {
						"referenceName": "HUBPerson",
						"type": "DatasetReference"
					},
					"name": "HUBPerson"
				},
				{
					"dataset": {
						"referenceName": "PersonSAT",
						"type": "DatasetReference"
					},
					"name": "SATPerson"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "PersonSAT",
						"type": "DatasetReference"
					},
					"name": "SinkSatPerson"
				},
				{
					"dataset": {
						"referenceName": "HUBPerson",
						"type": "DatasetReference"
					},
					"name": "SinkHubPerson"
				}
			],
			"transformations": [
				{
					"name": "hashColumns"
				},
				{
					"name": "CheckNewSatPerson"
				},
				{
					"name": "NewHubRecords"
				},
				{
					"name": "NewSatPerson"
				},
				{
					"name": "CheckNewPerson"
				},
				{
					"name": "NewHubPerson"
				}
			],
			"script": "source(output(\n\t\tBusinessEntityID as short,\n\t\tPersonType as string,\n\t\tNameStyle as boolean,\n\t\tTitle as string,\n\t\tFirstName as string,\n\t\tMiddleName as string,\n\t\tLastName as string,\n\t\tSuffix as string,\n\t\tEmailPromotion as short,\n\t\tAdditionalContactInfo as string,\n\t\tDemographics as string,\n\t\trowguid as string,\n\t\tModifiedDate as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> PersonSource\nsource(output(\n\t\tPersonVID as string,\n\t\tBusinessEntityID as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> HUBPerson\nsource(output(\n\t\tPersonVID as string,\n\t\tLoadDateTime as timestamp,\n\t\tNameStyle as boolean,\n\t\tEmailPromotion as integer,\n\t\tFirstName as string,\n\t\tLastName as string,\n\t\tPersonTypeCode as string,\n\t\tAdditionalContactInfo as string,\n\t\tDemographics as string,\n\t\tMiddleName as string,\n\t\tPasswordHash as string,\n\t\tPasswordSalt as string,\n\t\tSuffix as string,\n\t\tTitle as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SATPerson\nPersonSource derive(PersonVID = sha1(toString(BusinessEntityID) ),\n\t\tLoad_TS = currentTimestamp()) ~> hashColumns\nhashColumns, SATPerson exists(hashColumns@PersonVID == SATPerson@PersonVID,\n\tnegate:true,\n\tbroadcast: 'none')~> CheckNewSatPerson\nCheckNewSatPerson alterRow(insertIf(true())) ~> NewHubRecords\nNewHubRecords select(mapColumn(\n\t\tBusinessEntityID,\n\t\tPersonType,\n\t\tNameStyle,\n\t\tTitle,\n\t\tFirstName,\n\t\tMiddleName,\n\t\tLastName,\n\t\tSuffix,\n\t\tEmailPromotion,\n\t\tAdditionalContactInfo,\n\t\tDemographics,\n\t\trowguid,\n\t\tModifiedDate,\n\t\tPersonVID,\n\t\tLoadDateTime = Load_TS\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> NewSatPerson\nhashColumns, HUBPerson exists(hashColumns@PersonVID == HUBPerson@PersonVID,\n\tnegate:true,\n\tbroadcast: 'none')~> CheckNewPerson\nCheckNewPerson select(mapColumn(\n\t\tBusinessEntityID,\n\t\tPersonVID,\n\t\tLoadDateTime = Load_TS\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> NewHubPerson\nNewSatPerson sink(input(\n\t\tPersonVID as string,\n\t\tLoadDateTime as timestamp,\n\t\tNameStyle as boolean,\n\t\tEmailPromotion as integer,\n\t\tFirstName as string,\n\t\tLastName as string,\n\t\tPersonTypeCode as string,\n\t\tAdditionalContactInfo as string,\n\t\tDemographics as string,\n\t\tMiddleName as string,\n\t\tPasswordHash as string,\n\t\tPasswordSalt as string,\n\t\tSuffix as string,\n\t\tTitle as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tPersonVID,\n\t\tLoadDateTime,\n\t\tNameStyle,\n\t\tEmailPromotion,\n\t\tFirstName,\n\t\tLastName,\n\t\tPersonTypeCode = PersonType,\n\t\tAdditionalContactInfo,\n\t\tDemographics,\n\t\tMiddleName,\n\t\tPasswordHash = PersonVID,\n\t\tPasswordSalt = PersonVID,\n\t\tSuffix,\n\t\tTitle\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SinkSatPerson\nNewHubPerson sink(input(\n\t\tPersonVID as string,\n\t\tBusinessEntityID as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tPersonVID,\n\t\tBusinessEntityID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SinkHubPerson"
		}
	}
}